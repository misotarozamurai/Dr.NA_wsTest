<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dr.NA_front 送信テスト</title>
</head>
<body>
    <header>
        <h1>webSocket テストデータ送信</h1>
    </header>

    <main>
        <button type="button" onclick="startSend()">送信</button>
        <input type="text" id="data">
        <button onclick="dataSend()">データ送信</button>
        <button onclick="endSend()">終了</button>
    </main>
    
</body>
<script>
    'use strict'
    const ws = new WebSocket('wss://dr-na.mydns.jp:8889/ws');

    // 接続がされた場合
    ws.onopen = evt => console.log('webSocket open!');
    // エラーが発生した場合
    ws.onerror = err => console.error('webSocket onerror ERR: ', err);
    // メッセージを受信した場合
    ws.onmessage = evt => {
        console.log('webSocket onmessage()');
        console.log(evt.data);
    }

    // アニメーション起動
    const startSend = () => {
        const _send = {
            "type": "result",
            "pulse": {
                "avg": 65,
                "datas":[
                    80,
                    75,
                    78,
                    73,
                    76,
                    68,
                    66,
                    67,
                    68,
                    75
                ]
            },
            "height": 173.2,
            "sick": {
                "name": "胃癌",
                "place": 1,
                "message": "胃癌は主にピロリ菌の感染が原因でおこります。特に50代から急増する病気になります。"
            }
        };

        ws.send(JSON.stringify(_send));
    }

    // 起動時のメッセージ送信
    const dataSend = () => {
        const _send = {
            "type": "message",
            "message": document.getElementById('data').value
        }

        ws.send(JSON.stringify(_send));
    }

    // アニメーション終了
    const endSend = () => {
        const _send = {
            "type": "Animation END",
            "message": "End of diagnosis"
        }

        ws.send(JSON.stringify(_send));
    }
</script>
</html>